<section class="forgot-card animate-fade-in-up" aria-labelledby="forgot-heading">

  @if (!submitted()) {
    <header class="forgot-card__header">
      <div class="forgot-card__back-link-wrapper">
        <a routerLink="/auth/login" class="forgot-card__back-link" aria-label="Volver al inicio de sesión">
          <i class="pi pi-arrow-left" aria-hidden="true"></i>
          Volver
        </a>
      </div>
      <div class="forgot-card__icon" aria-hidden="true">
        <i class="pi pi-envelope"></i>
      </div>
      <h1 class="forgot-card__title" id="forgot-heading">Recuperar contraseña</h1>
      <p class="forgot-card__subtitle">
        Ingresa tu correo electrónico y te enviaremos instrucciones para restablecer tu contraseña.
      </p>
    </header>

    <form
      class="forgot-card__form"
      [formGroup]="form"
      (ngSubmit)="onSubmit()"
      novalidate
      aria-label="Formulario de recuperación de contraseña"
    >
      <div class="forgot-card__field-group">
        <label for="forgot-email" class="forgot-card__label">
          Correo electrónico
        </label>
        <div class="p-input-icon-left forgot-card__input-wrapper">
          <i class="pi pi-envelope" aria-hidden="true"></i>
          <input
            pInputText
            id="forgot-email"
            type="email"
            formControlName="email"
            placeholder="usuario@universidad.edu"
            autocomplete="email"
            class="forgot-card__input"
            [class.p-invalid]="emailControl.invalid && (emailControl.dirty || emailControl.touched)"
            aria-required="true"
            [attr.aria-invalid]="emailControl.invalid && emailControl.touched"
            [attr.aria-describedby]="emailError ? 'forgot-email-error' : null"
          />
        </div>
        @if (emailError) {
          <small id="forgot-email-error" class="forgot-card__field-error" role="alert">
            <i class="pi pi-exclamation-circle" aria-hidden="true"></i>
            {{ emailError }}
          </small>
        }
      </div>

      <button
        pButton
        type="submit"
        class="forgot-card__submit-btn"
        [disabled]="isLoading()"
        [attr.aria-busy]="isLoading()"
      >
        @if (isLoading()) {
          <i class="pi pi-spin pi-spinner" aria-hidden="true"></i>
          Enviando...
        } @else {
          Enviar instrucciones
        }
      </button>
    </form>

  } @else {
    <!-- Success state -->
    <div class="forgot-card__success animate-fade-in" role="status" aria-live="polite">
      <div class="forgot-card__success-icon" aria-hidden="true">
        <i class="pi pi-check-circle"></i>
      </div>
      <h1 class="forgot-card__title" id="forgot-heading">Revisa tu correo</h1>
      <p class="forgot-card__success-text">
        Si tu correo está registrado, recibirás instrucciones para restablecer tu contraseña.
        Revisa tu bandeja de entrada y también la carpeta de spam.
      </p>
      <a routerLink="/auth/login" class="forgot-card__return-btn">
        <i class="pi pi-arrow-left" aria-hidden="true"></i>
        Volver al inicio de sesión
      </a>
    </div>
  }

</section>
